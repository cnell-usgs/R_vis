library(shiny)
library(ggplot2)
library(vegan)
library(EcoSimR)
library(dplyr)
library(readr)


source_url("https://raw.githubusercontent.com/collnell/R_vis/master/theme_mooney.R")#ggplot theme


shinyServer(function(input,output){
  
  
  values<-reactiveValues()
  
  ##generate random community matrix using ecosimr
  test.mat<-eventReactive(input$rarefy, {#rows are sp, cols are sites
    ranMatGen(aBetaRow=1, bBetaRow=1, 
              aBetaCol=1, bBetaCol =1, 
              numRows=60, numCols=50, 
              mFill =1, abun =400,
              emptyRow=FALSE, emptyCol=FALSE)
  })
  
  
  
  output$rarefaction<-renderPlot({
    
    sg<-specaccum(test.mat()$m,method="rarefaction") ##run rarefaction using vegan
    sdf<-data.frame(ind = sg$individuals,
                    rich =sg$richness,
                    site=sg$sites,
                    sd=sg$sd)
    
    
    rar.plot<-ggplot(sdf,aes(x=ind,y=rich))+geom_point(size=2)+
      labs(x="Individuals",y="Species Richness")+
      theme_mooney(legend.location="bottom")
    
    rar.plot
    
    
  })
  
})
